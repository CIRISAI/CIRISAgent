"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9484],{3120:(e,t,o)=>{o.d(t,{_:()=>l});var a=o(704);function n(){let e=window.location.hostname,t=window.location.pathname,o=t.startsWith("/agent/");if("agents.ciris.ai"!==e&&!o)return{mode:"standalone",agentId:"default",apiBase:"/v1"};{let e="default";e=o?t.split("/")[2]||"default":localStorage.getItem("selectedAgentId")||"default";let a="/api/".concat(e,"/v1");return{mode:"managed",agentId:e,apiBase:a}}}var i=o(5950);class r{configure(e,t){let o,{mode:a}=n();if("managed"===a)o="".concat(window.location.origin,"/api/").concat(e);else{let t=localStorage.getItem("agent_".concat(e,"_api_url"));o=t||window.location.origin}t||(t=i.a.getAccessToken()||void 0);let r={baseURL:o,authToken:t,agentId:e,mode:a};return this.hasConfigChanged(r)&&this.applyConfiguration(r),r}configureForOAuthCallback(e,t){let o,{mode:a}=n(),i={baseURL:"managed"===a?"".concat(window.location.origin,"/api/").concat(e):window.location.origin,authToken:t,agentId:e,mode:a};return this.applyConfiguration(i),this.storeConfiguration(i),i}getCurrentConfig(){return this.currentConfig}isConfiguredFor(e){return!!this.currentConfig&&this.currentConfig.agentId===e&&!!this.currentConfig.authToken}clear(){this.currentConfig=null,localStorage.removeItem("sdk_config"),this.log("SDK configuration cleared")}applyConfiguration(e){this.log("Applying SDK configuration:",e),a.AQ.setConfig({baseURL:e.baseURL,authToken:e.authToken}),this.currentConfig=e,this.log("SDK configured successfully")}hasConfigChanged(e){return!this.currentConfig||this.currentConfig.baseURL!==e.baseURL||this.currentConfig.authToken!==e.authToken||this.currentConfig.agentId!==e.agentId||this.currentConfig.mode!==e.mode}storeConfiguration(e){let t={baseURL:e.baseURL,agentId:e.agentId,mode:e.mode};localStorage.setItem("sdk_config",JSON.stringify(t)),"standalone"===e.mode&&e.baseURL!==window.location.origin&&localStorage.setItem("agent_".concat(e.agentId,"_api_url"),e.baseURL)}restoreConfiguration(){let e=localStorage.getItem("sdk_config");if(!e)return null;try{let t=JSON.parse(e),o=i.a.getAccessToken()||void 0;return{...t,authToken:o}}catch(e){return null}}log(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];this.debugMode&&console.log("[SDKConfigManager]",...t)}constructor(){this.currentConfig=null,this.debugMode=!1}}let l=new r},9484:(e,t,o)=>{o.d(t,{A:()=>g,O:()=>u});var a=o(4568),n=o(7620),i=o(2942),r=o(3237),l=o(704),s=o(3120);let c=(0,n.createContext)(void 0);function u(e){let{children:t}=e,[o,u]=(0,n.useState)(null),[g,d]=(0,n.useState)(!0),[h,m]=(0,n.useState)(null),f=(0,i.useRouter)();(0,n.useEffect)(()=>{let e=window.location.pathname;"/login"===e||e.startsWith("/manager")?d(!1):_().then(e=>{e||p()});let t=localStorage.getItem("manager_token");t&&m(t);let o=e=>{console.log("[AuthContext] Native auth ready event received"),_()};return window.addEventListener("ciris_native_auth_ready",o),()=>{window.removeEventListener("ciris_native_auth_ready",o)}},[]);let _=async()=>{let e="true"===localStorage.getItem("isNativeApp"),t=localStorage.getItem("ciris_native_auth"),o=localStorage.getItem("ciris_auth_method"),a="true"===localStorage.getItem("ciris_show_setup"),n=window.location.pathname;if(console.log("[AuthContext] checkNativeAuth called - path:",n,"isNativeApp:",e,"showSetup:",a),!e||!t)return console.log("[AuthContext] Not native app or no auth data, skipping"),!1;let i="true"===localStorage.getItem("ciris_native_auth_complete"),r=localStorage.getItem("ciris_native_auth_token");if(i&&r){console.log("[AuthContext] Native auth already complete, restoring session"),s._.configure("datum",r);try{let e={user_id:"admin",username:"admin",role:"SYSTEM_ADMIN",api_role:"ADMIN",permissions:["read","write","admin"],created_at:new Date().toISOString()};return u(e),d(!1),a&&!n.startsWith("/setup")?(console.log("[AuthContext] Session restored but need to redirect to setup - current path:",n),localStorage.setItem("ciris_native_llm_mode","google"===o?"ciris_proxy":"custom"),window.location.href="/setup"):console.log("[AuthContext] Session restored, already on correct page or setup not needed"),!0}catch(e){console.error("[AuthContext] Failed to restore session:",e),localStorage.removeItem("ciris_native_auth_complete"),localStorage.removeItem("ciris_native_auth_token")}}if(l.AQ.isAuthenticated())return console.log("[AuthContext] Already authenticated in SDK, skipping native auth login"),!0;try{let e=JSON.parse(t);console.log("[AuthContext] Native auth detected - method:",o,"showSetup:",a,"currentPath:",n),localStorage.setItem("selectedAgentId","datum"),s._.configure("datum");try{console.log("[AuthContext] Attempting login with default credentials...");let e=await l.AQ.login("admin","ciris_admin_password"),t=l.AQ.auth.getAccessToken();return t&&(s._.configure("datum",t),localStorage.setItem("ciris_native_auth_token",t),localStorage.setItem("ciris_native_auth_complete","true"),console.log("[AuthContext] Token saved to localStorage")),u(e),console.log("[AuthContext] Native auth login successful"),d(!1),a&&!n.startsWith("/setup")?(console.log("[AuthContext] Redirecting to setup wizard via window.location.href"),localStorage.setItem("ciris_native_llm_mode","google"===o?"ciris_proxy":"custom"),window.location.href="/setup"):console.log("[AuthContext] Not redirecting - showSetup:",a,"currentPath:",n),!0}catch(i){console.error("[AuthContext] Native auth login failed:",i);let t={user_id:e.googleUserId||"native_user",username:e.displayName||"Native User",role:"ADMIN",api_role:"ADMIN",permissions:["read","write","admin"],created_at:new Date().toISOString()};return u(t),d(!1),localStorage.setItem("ciris_native_auth_complete","true"),a&&!n.startsWith("/setup")&&(console.log("[AuthContext] Redirecting to setup wizard (mock user) via window.location.href"),localStorage.setItem("ciris_native_llm_mode","google"===o?"ciris_proxy":"custom"),window.location.href="/setup"),!0}}catch(e){return console.error("[AuthContext] Failed to parse native auth data:",e),!1}},p=async()=>{try{if(l.AQ.isAuthenticated()){let e=await l.AQ.auth.getMe();u(e)}}catch(e){console.error("Auth check failed:",e)}finally{d(!1)}},A=(0,n.useCallback)(async(e,t)=>{try{let o=localStorage.getItem("selectedAgentId");if(!o)throw Error("No agent selected");s._.configure(o);let a=await l.AQ.login(e,t),n=l.AQ.auth.getAccessToken();n&&s._.configure(o,n),u(a),r.Ay.success("Welcome, ".concat(a.username||a.user_id,"!")),f.push("/")}catch(e){throw r.Ay.error(e.message||"Login failed"),e}},[f]),C=(0,n.useCallback)(async()=>{try{await l.AQ.logout(),u(null),r.Ay.success("Logged out successfully"),f.push("/login")}catch(e){console.error("Logout failed:",e),r.Ay.error("Logout failed")}},[f]),w=(0,n.useCallback)(e=>!!o&&(o.permissions.includes(e)||"SYSTEM_ADMIN"===o.role),[o]),S=(0,n.useCallback)(e=>{if(!o)return!1;let t=["OBSERVER","ADMIN","AUTHORITY","SYSTEM_ADMIN"];return t.indexOf(o.role)>=t.indexOf(e)},[o]),v=(0,n.useCallback)(e=>{l.AQ.setConfig({authToken:e})},[]),I=(0,n.useCallback)(()=>!!h,[h]);return(0,a.jsx)(c.Provider,{value:{user:o,loading:g,login:A,logout:C,hasPermission:w,hasRole:S,setUser:u,setToken:v,managerToken:h,setManagerToken:m,isManagerAuthenticated:I},children:t})}function g(){let e=(0,n.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);
