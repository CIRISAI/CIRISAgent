(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1520],{1166:(e,t,n)=>{Promise.resolve().then(n.bind(n,4887))},2942:(e,t,n)=>{"use strict";var a=n(2418);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},3120:(e,t,n)=>{"use strict";n.d(t,{_:()=>s});var a=n(704);function r(){let e=window.location.hostname,t=window.location.pathname,n=t.startsWith("/agent/");if("agents.ciris.ai"!==e&&!n)return{mode:"standalone",agentId:"default",apiBase:"/v1"};{let e="default";e=n?t.split("/")[2]||"default":localStorage.getItem("selectedAgentId")||"default";let a="/api/".concat(e,"/v1");return{mode:"managed",agentId:e,apiBase:a}}}var o=n(5950);class i{configure(e,t){let n,{mode:a}=r();if("managed"===a)n="".concat(window.location.origin,"/api/").concat(e);else{let t=localStorage.getItem("agent_".concat(e,"_api_url"));n=t||window.location.origin}t||(t=o.a.getAccessToken()||void 0);let i={baseURL:n,authToken:t,agentId:e,mode:a};return this.hasConfigChanged(i)&&this.applyConfiguration(i),i}configureForOAuthCallback(e,t){let n,{mode:a}=r(),o={baseURL:"managed"===a?"".concat(window.location.origin,"/api/").concat(e):window.location.origin,authToken:t,agentId:e,mode:a};return this.applyConfiguration(o),this.storeConfiguration(o),o}getCurrentConfig(){return this.currentConfig}isConfiguredFor(e){return!!this.currentConfig&&this.currentConfig.agentId===e&&!!this.currentConfig.authToken}clear(){this.currentConfig=null,localStorage.removeItem("sdk_config"),this.log("SDK configuration cleared")}applyConfiguration(e){this.log("Applying SDK configuration:",e),a.AQ.setConfig({baseURL:e.baseURL,authToken:e.authToken}),this.currentConfig=e,this.log("SDK configured successfully")}hasConfigChanged(e){return!this.currentConfig||this.currentConfig.baseURL!==e.baseURL||this.currentConfig.authToken!==e.authToken||this.currentConfig.agentId!==e.agentId||this.currentConfig.mode!==e.mode}storeConfiguration(e){let t={baseURL:e.baseURL,agentId:e.agentId,mode:e.mode};localStorage.setItem("sdk_config",JSON.stringify(t)),"standalone"===e.mode&&e.baseURL!==window.location.origin&&localStorage.setItem("agent_".concat(e.agentId,"_api_url"),e.baseURL)}restoreConfiguration(){let e=localStorage.getItem("sdk_config");if(!e)return null;try{let t=JSON.parse(e),n=o.a.getAccessToken()||void 0;return{...t,authToken:n}}catch(e){return null}}log(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.debugMode&&console.log("[SDKConfigManager]",...t)}constructor(){this.currentConfig=null,this.debugMode=!1}}let s=new i},4887:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var a=n(4568),r=n(7620),o=n(2942),i=n(9484);function s(){let e=(0,o.useRouter)(),t=(0,o.useSearchParams)(),{setManagerToken:n}=(0,i.A)();return(0,r.useEffect)(()=>{(async()=>{let a=t.get("token"),r=t.get("error");if(r){console.error("Manager OAuth error:",r),e.push("/login?error=manager_auth_failed");return}a?(localStorage.setItem("manager_token",a),n(a),e.push("/manager")):e.push("/login")})()},[t,e,n]),(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Authenticating with Manager..."}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please wait while we complete the authentication."})]})})}function l(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Loading..."})})}),children:(0,a.jsx)(s,{})})}},9484:(e,t,n)=>{"use strict";n.d(t,{A:()=>g,O:()=>u});var a=n(4568),r=n(7620),o=n(2942),i=n(3237),s=n(704),l=n(3120);let c=(0,r.createContext)(void 0);function u(e){let{children:t}=e,[n,u]=(0,r.useState)(null),[g,d]=(0,r.useState)(!0),[h,f]=(0,r.useState)(null),m=(0,o.useRouter)();(0,r.useEffect)(()=>{let e=window.location.pathname;"/login"===e||e.startsWith("/manager")?d(!1):C();let t=localStorage.getItem("manager_token");t&&f(t)},[]);let C=async()=>{try{if(s.AQ.isAuthenticated()){let e=await s.AQ.auth.getMe();u(e)}}catch(e){console.error("Auth check failed:",e)}finally{d(!1)}},A=(0,r.useCallback)(async(e,t)=>{try{let n=localStorage.getItem("selectedAgentId");if(!n)throw Error("No agent selected");l._.configure(n);let a=await s.AQ.login(e,t),r=s.AQ.auth.getAccessToken();r&&l._.configure(n,r),u(a),i.Ay.success("Welcome, ".concat(a.username||a.user_id,"!")),m.push("/")}catch(e){throw i.Ay.error(e.message||"Login failed"),e}},[m]),p=(0,r.useCallback)(async()=>{try{await s.AQ.logout(),u(null),i.Ay.success("Logged out successfully"),m.push("/login")}catch(e){console.error("Logout failed:",e),i.Ay.error("Logout failed")}},[m]),w=(0,r.useCallback)(e=>!!n&&(n.permissions.includes(e)||"SYSTEM_ADMIN"===n.role),[n]),b=(0,r.useCallback)(e=>{if(!n)return!1;let t=["OBSERVER","ADMIN","AUTHORITY","SYSTEM_ADMIN"];return t.indexOf(n.role)>=t.indexOf(e)},[n]),k=(0,r.useCallback)(e=>{s.AQ.setConfig({authToken:e})},[]),y=(0,r.useCallback)(()=>!!h,[h]);return(0,a.jsx)(c.Provider,{value:{user:n,loading:g,login:A,logout:p,hasPermission:w,hasRole:b,setUser:u,setToken:k,managerToken:h,setManagerToken:f,isManagerAuthenticated:y},children:t})}function g(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[4534,704,587,8315,7358],()=>t(1166)),_N_E=e.O()}]);