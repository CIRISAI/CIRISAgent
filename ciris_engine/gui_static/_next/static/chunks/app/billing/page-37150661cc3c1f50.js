(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7522],{47551:(e,s,t)=>{Promise.resolve().then(t.bind(t,56927))},56927:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var r=t(54568),a=t(7620),l=t(78451),n=t(58960),i=t(704);let c={appearance:{theme:"stripe",variables:{colorPrimary:"#3B82F6",colorBackground:"#FFFFFF",colorText:"#1F2937",colorDanger:"#EF4444",fontFamily:"Inter, system-ui, sans-serif",spacingUnit:"4px",borderRadius:"8px"}}};function d(e){let{credits:s,onPurchaseClick:t}=e;if(!s)return(0,r.jsx)("div",{className:"animate-pulse bg-gray-200 h-20 rounded-lg"});let a=s.free_uses_remaining>0,l=s.credits_remaining<5&&0===s.free_uses_remaining,n=!s.has_credit,i="\uD83D\uDCB5",c="text-blue-600 bg-blue-50 border-blue-200",d="".concat(s.credits_remaining," credits remaining");return a?(i="\uD83C\uDF81",c=1===s.free_uses_remaining?"text-orange-600 bg-orange-50 border-orange-200":"text-green-600 bg-green-50 border-green-200",d="".concat(s.free_uses_remaining," free tries remaining")):n?(i="\uD83D\uDCB3",c="text-red-600 bg-red-50 border-red-200",d="0 credits remaining"):l&&(i="⚠️",c="text-orange-600 bg-orange-50 border-orange-200",d="".concat(s.credits_remaining," credits remaining")),(0,r.jsx)("div",{className:"".concat(c," border-2 rounded-lg p-6 cursor-pointer hover:shadow-lg transition-shadow"),onClick:()=>(n||l)&&t(),children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("span",{className:"text-5xl",children:i}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:d}),(0,r.jsxs)("p",{className:"text-sm mt-1",children:[a&&"Try CIRIS for free! No credit card required.",n&&"Purchase more uses to continue",l&&!a&&"Running low! Purchase more to avoid interruptions",!n&&!l&&!a&&"Click to purchase more"]}),s.purchase_options&&(0,r.jsxs)("p",{className:"text-sm font-medium mt-2",children:["\uD83D\uDCB0 ",s.purchase_options.uses," uses for $",(s.purchase_options.price_minor/100).toFixed(2)]})]}),(n||l)&&(0,r.jsx)("button",{className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Purchase"})]})})}function o(e){let{purchaseInfo:s,onSuccess:t,onError:l,onCancel:i}=e,c=(0,n.t2)(),d=(0,n.HH)(),[o,x]=(0,a.useState)(!1),u=async e=>{if(e.preventDefault(),!c||!d)return;let r=d.getElement(n.hA);if(r){x(!0);try{let{error:e,paymentIntent:a}=await c.confirmCardPayment(s.client_secret,{payment_method:{card:r}});e?l(e.message||"Payment failed"):((null==a?void 0:a.status)==="succeeded"||(null==a?void 0:a.status)==="processing")&&t(s.payment_id)}catch(e){l("An unexpected error occurred")}finally{x(!1)}}};return(0,r.jsxs)("form",{onSubmit:u,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Payment Details"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:[s.uses_purchased," uses for $",(s.amount_minor/100).toFixed(2)]})]}),(0,r.jsx)("div",{className:"border border-gray-300 rounded-lg p-4",children:(0,r.jsx)(n.hA,{options:{style:{base:{fontSize:"16px",color:"#1F2937","::placeholder":{color:"#9CA3AF"}},invalid:{color:"#EF4444",iconColor:"#EF4444"}}}})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,r.jsx)("span",{children:"\uD83D\uDD12"}),(0,r.jsx)("span",{children:"Secure payment powered by Stripe"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{type:"submit",disabled:!c||o,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium",children:o?"Processing...":"Pay $".concat((s.amount_minor/100).toFixed(2))}),(0,r.jsx)("button",{type:"button",onClick:i,disabled:o,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 disabled:bg-gray-100 disabled:cursor-not-allowed transition-colors font-medium",children:"Cancel"})]})]})}function x(e){var s;let{isOpen:t,onClose:d,onSuccess:x,credits:u}=e,[m,h]=(0,a.useState)("prompt"),[g,p]=(0,a.useState)(null),[b,y]=(0,a.useState)(null),[j,N]=(0,a.useState)(null),[f,v]=(0,a.useState)(0),_=async()=>{h("payment");try{let e=new i.CIRISClient,s=await e.billing.initiatePurchase({return_url:window.location.href});y(s),N((0,l.c)(s.publishable_key))}catch(e){p("Failed to initialize payment. Please try again."),h("error")}},w=async e=>{for(let s=0;s<30;s++)try{let s=new i.CIRISClient,t=await s.billing.getPurchaseStatus(e);if("succeeded"===t.status){v(t.credits_added),h("success"),setTimeout(()=>{x(),d()},2e3);return}if("failed"===t.status||"canceled"===t.status){p("Payment ".concat(t.status,". Please try again.")),h("error");return}await new Promise(e=>setTimeout(e,2e3))}catch(e){console.error("Error polling payment status:",e),await new Promise(e=>setTimeout(e,2e3))}p("Payment status unknown after 60 seconds. Please check your credit balance or contact support."),h("error")};return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 animate-fade-in",children:["prompt"===m&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Continue with CIRIS"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:(null==u?void 0:u.free_uses_remaining)===0?"You've used your 3 free tries! Purchase more to continue.":"Purchase more uses to continue using CIRIS."})]}),(null==u?void 0:u.purchase_options)&&(0,r.jsx)("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-3xl font-bold text-blue-600",children:["$",(u.purchase_options.price_minor/100).toFixed(2)]}),(0,r.jsxs)("p",{className:"text-gray-700 mt-1",children:["for ",u.purchase_options.uses," uses"]})]})}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)("button",{onClick:_,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:["Purchase ",(null==u||null==(s=u.purchase_options)?void 0:s.uses)||20," uses"]}),(0,r.jsx)("button",{onClick:d,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Not now"})]})]}),"payment"===m&&j&&b&&(0,r.jsx)(n.S8,{stripe:j,options:c,children:(0,r.jsx)(o,{purchaseInfo:b,onSuccess:e=>{h("processing"),w(e)},onError:e=>{p(e),h("error")},onCancel:d})}),"processing"===m&&(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto"}),(0,r.jsx)("p",{className:"text-gray-600 mt-4",children:"Processing payment and adding credits..."}),(0,r.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"This may take a few moments"})]}),"success"===m&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"✓"}),(0,r.jsx)("h3",{className:"text-2xl font-bold text-green-600 mb-2",children:"Purchase Successful!"}),(0,r.jsxs)("p",{className:"text-gray-700",children:[f," ",1===f?"use":"uses"," added to your account"]})]}),"error"===m&&(0,r.jsxs)("div",{className:"text-center py-8 space-y-6",children:[(0,r.jsx)("div",{className:"text-6xl text-red-500",children:"✕"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Payment Failed"}),(0,r.jsx)("p",{className:"text-gray-600",children:g})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>{p(null),h("prompt")},className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Try Again"}),(0,r.jsx)("button",{onClick:d,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Cancel"})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Need help? ",(0,r.jsx)("a",{href:"/support",className:"text-blue-600 hover:underline",children:"Contact support"})]})]})]})}):null}function u(){let[e,s]=(0,a.useState)(null),[t,l]=(0,a.useState)(!0),[n,c]=(0,a.useState)(null),[o,u]=(0,a.useState)(!1),[m]=(0,a.useState)(()=>new i.CIRISClient),h=async()=>{l(!0),c(null);try{let e=await m.billing.getCredits();s(e)}catch(e){console.error("Failed to load credits:",e),c("Failed to load credit information. Please try again.")}finally{l(!1)}};return(0,a.useEffect)(()=>{h()},[]),(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Billing"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"Manage your CIRIS credits and purchases"})]}),t&&(0,r.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,r.jsx)("div",{className:"h-32 bg-gray-200 rounded-lg"}),(0,r.jsx)("div",{className:"h-64 bg-gray-200 rounded-lg"})]}),n&&!t&&(0,r.jsxs)("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-6 text-center",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"⚠️"}),(0,r.jsx)("h3",{className:"text-xl font-bold text-red-900 mb-2",children:"Connection Error"}),(0,r.jsx)("p",{className:"text-red-700 mb-4",children:n}),(0,r.jsx)("button",{onClick:h,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Retry"})]}),!t&&!n&&e&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(d,{credits:e,onPurchaseClick:()=>u(!0)}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Usage Statistics"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Total Uses"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.total_uses})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Current Plan"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.plan_name})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Free Uses"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.free_uses_remaining})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Paid Credits"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.credits_remaining-e.free_uses_remaining})]})]})]}),e.purchase_options&&(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Purchase More Uses"}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-lg p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-3xl font-bold text-blue-600",children:["$",(e.purchase_options.price_minor/100).toFixed(2)]}),(0,r.jsxs)("p",{className:"text-gray-700 mt-1",children:["Get ",e.purchase_options.uses," additional uses"]})]}),(0,r.jsx)("button",{onClick:()=>u(!0),className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg",children:"Purchase Now"})]})})]}),(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,r.jsx)("h3",{className:"font-bold text-blue-900 mb-2",children:"\uD83D\uDCA1 About Credits"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,r.jsx)("li",{children:"• Each interaction with CIRIS uses one credit"}),(0,r.jsx)("li",{children:"• Free tries are provided to new users"}),(0,r.jsx)("li",{children:"• Purchased credits never expire"}),(0,r.jsx)("li",{children:"• Secure payments processed by Stripe"})]})]})]}),(0,r.jsx)(x,{isOpen:o,onClose:()=>u(!1),onSuccess:()=>{h()},credits:e})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[6783,704,587,8315,7358],()=>s(47551)),_N_E=e.O()}]);
