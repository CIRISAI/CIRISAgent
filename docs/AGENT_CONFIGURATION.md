# Agent Configuration Guide

## Templates

CIRIS provides several pre-approved templates:

- **scout** - Basic agent for exploration and learning
- **sage** - Wise agent with deeper reasoning capabilities
- **echo** - Simple agent that echoes messages (for testing)
- **teacher** - Educational agent for tutoring

## Essential Environment Variables

### Adapter Configuration (REQUIRED)
```yaml
environment:
  CIRIS_ADAPTER: api        # Options: api, discord, cli
  CIRIS_AGENT_ID: my-agent  # Auto-generated by Manager
```

### API Adapter
```yaml
environment:
  CIRIS_ADAPTER: api
  CIRIS_API_HOST: 0.0.0.0   # Required for external access
  CIRIS_API_PORT: 8080      # Internal port (do not change)
```

### Discord Adapter
```yaml
environment:
  CIRIS_ADAPTER: discord
  DISCORD_TOKEN: "your-bot-token-here"
  DISCORD_HOME_CHANNEL_ID: "channel-id-here"
```

### LLM Configuration
```yaml
environment:
  # For testing (no API keys needed)
  CIRIS_USE_MOCK_LLM: "true"

  # For OpenAI
  OPENAI_API_KEY: "sk-..."
  CIRIS_LLM_PROVIDER: "openai"
  CIRIS_LLM_MODEL: "gpt-4o"

  # For Anthropic
  ANTHROPIC_API_KEY: "sk-ant-..."
  CIRIS_LLM_PROVIDER: "anthropic"
  CIRIS_LLM_MODEL: "claude-3-5-sonnet-20241022"
```

## Creating Agents

### Docker Compose
```yaml
version: '3.8'
services:
  my-agent:
    container_name: ciris-my-agent
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8090:8080"
    environment:
      CIRIS_AGENT_ID: my-agent
      CIRIS_ADAPTER: api
      CIRIS_API_HOST: 0.0.0.0
      CIRIS_TEMPLATE: scout
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    volumes:
      - ./data/my-agent:/app/data
      - ./logs/my-agent:/app/logs
    restart: on-failure
```

## Post-Creation Configuration

### 1. Discord Bot Setup
After creating a Discord agent:
1. Create a Discord application at https://discord.com/developers
2. Add bot to your server with appropriate permissions
3. Copy the bot token
4. Update agent environment with token
5. Restart agent

### 2. API Authentication
Default credentials:
- Username: `admin`
- Password: `ciris_admin_password`

To change:
1. Stop agent
2. Delete `/app/data/ciris_auth.db` in container
3. Set new credentials via environment
4. Restart agent

### 3. Persistent Storage
Agents store data in:
- `/app/data/` - Databases, configuration
- `/app/logs/` - Application and incident logs

Mount these as volumes to persist data.

## Monitoring Agents

### Health Check
```bash
curl http://localhost:<port>/v1/system/health
```

### View Logs
```bash
docker logs ciris-<agent-id>
```

### Check Incidents
```bash
docker exec ciris-<agent-id> tail -n 100 /app/logs/incidents_latest.log
```

### Agent Status via Manager
```bash
curl http://localhost:8888/manager/v1/agents
```

## Common Issues

### Agent exits immediately
- Ensure `CIRIS_ADAPTER` is set to `api` or `discord`
- CLI adapter exits after wakeup by design

### API not accessible
- Check `CIRIS_API_HOST=0.0.0.0` is set
- Verify port mapping in docker-compose
- Check nginx routing

### Discord not connecting
- Verify `DISCORD_TOKEN` is correct
- Check `DISCORD_HOME_CHANNEL_ID` exists
- Ensure bot has proper permissions

## Advanced Configuration

### Memory Backend
```yaml
environment:
  CIRIS_MEMORY_BACKEND: neo4j
  NEO4J_URI: bolt://localhost:7687
  NEO4J_USER: neo4j
  NEO4J_PASSWORD: password
```

### Custom Prompts
Mount custom prompts directory:
```yaml
volumes:
  - ./custom_prompts:/app/custom_prompts
environment:
  CIRIS_PROMPTS_DIR: /app/custom_prompts
```

### Resource Limits
```yaml
deploy:
  resources:
    limits:
      cpus: '2'
      memory: 4G
    reservations:
      cpus: '1'
      memory: 2G
```
