(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2580],{2942:(e,t,a)=>{"use strict";var o=a(2418);a.o(o,"usePathname")&&a.d(t,{usePathname:function(){return o.usePathname}}),a.o(o,"useRouter")&&a.d(t,{useRouter:function(){return o.useRouter}}),a.o(o,"useSearchParams")&&a.d(t,{useSearchParams:function(){return o.useSearchParams}})},3120:(e,t,a)=>{"use strict";a.d(t,{_:()=>i});var o=a(704);function r(){let e=window.location.hostname,t=window.location.pathname,a=t.startsWith("/agent/");if("agents.ciris.ai"!==e&&!a)return{mode:"standalone",agentId:"default",apiBase:"/v1"};{let e="default";e=a?t.split("/")[2]||"default":localStorage.getItem("selectedAgentId")||"default";let o="/api/".concat(e,"/v1");return{mode:"managed",agentId:e,apiBase:o}}}var n=a(5950);class s{configure(e,t){let a,{mode:o}=r();if("managed"===o)a="".concat(window.location.origin,"/api/").concat(e);else{let t=localStorage.getItem("agent_".concat(e,"_api_url"));a=t||window.location.origin}t||(t=n.a.getAccessToken()||void 0);let s={baseURL:a,authToken:t,agentId:e,mode:o};return this.hasConfigChanged(s)&&this.applyConfiguration(s),s}configureForOAuthCallback(e,t){let a,{mode:o}=r(),n={baseURL:"managed"===o?"".concat(window.location.origin,"/api/").concat(e):window.location.origin,authToken:t,agentId:e,mode:o};return this.applyConfiguration(n),this.storeConfiguration(n),n}getCurrentConfig(){return this.currentConfig}isConfiguredFor(e){return!!this.currentConfig&&this.currentConfig.agentId===e&&!!this.currentConfig.authToken}clear(){this.currentConfig=null,localStorage.removeItem("sdk_config"),this.log("SDK configuration cleared")}applyConfiguration(e){this.log("Applying SDK configuration:",e),o.AQ.setConfig({baseURL:e.baseURL,authToken:e.authToken}),this.currentConfig=e,this.log("SDK configured successfully")}hasConfigChanged(e){return!this.currentConfig||this.currentConfig.baseURL!==e.baseURL||this.currentConfig.authToken!==e.authToken||this.currentConfig.agentId!==e.agentId||this.currentConfig.mode!==e.mode}storeConfiguration(e){let t={baseURL:e.baseURL,agentId:e.agentId,mode:e.mode};localStorage.setItem("sdk_config",JSON.stringify(t)),"standalone"===e.mode&&e.baseURL!==window.location.origin&&localStorage.setItem("agent_".concat(e.agentId,"_api_url"),e.baseURL)}restoreConfiguration(){let e=localStorage.getItem("sdk_config");if(!e)return null;try{let t=JSON.parse(e),a=n.a.getAccessToken()||void 0;return{...t,authToken:a}}catch(e){return null}}log(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];this.debugMode&&console.log("[SDKConfigManager]",...t)}constructor(){this.currentConfig=null,this.debugMode=!1}}let i=new s},8366:(e,t,a)=>{Promise.resolve().then(a.bind(a,9585))},9484:(e,t,a)=>{"use strict";a.d(t,{A:()=>g,O:()=>u});var o=a(4568),r=a(7620),n=a(2942),s=a(3237),i=a(704),l=a(3120);let c=(0,r.createContext)(void 0);function u(e){let{children:t}=e,[a,u]=(0,r.useState)(null),[g,d]=(0,r.useState)(!0),[h,m]=(0,r.useState)(null),f=(0,n.useRouter)();(0,r.useEffect)(()=>{let e=window.location.pathname;"/login"===e||e.startsWith("/manager")?d(!1):p().then(e=>{e||_()});let t=localStorage.getItem("manager_token");t&&m(t);let a=e=>{console.log("[AuthContext] Native auth ready event received"),p()};return window.addEventListener("ciris_native_auth_ready",a),()=>{window.removeEventListener("ciris_native_auth_ready",a)}},[]);let p=async()=>{let e="true"===localStorage.getItem("isNativeApp"),t=localStorage.getItem("ciris_native_auth"),a=localStorage.getItem("ciris_auth_method"),o="true"===localStorage.getItem("ciris_show_setup");if(!e||!t)return!1;try{let e=JSON.parse(t);console.log("[AuthContext] Native auth detected - method:",a,"showSetup:",o),localStorage.setItem("selectedAgentId","datum"),l._.configure("datum");try{let e=await i.AQ.login("admin","ciris_admin_password"),t=i.AQ.auth.getAccessToken();return t&&l._.configure("datum",t),u(e),console.log("[AuthContext] Native auth login successful"),d(!1),o&&(console.log("[AuthContext] Redirecting to setup wizard"),localStorage.setItem("ciris_native_llm_mode","google"===a?"ciris_proxy":"custom"),f.push("/setup")),!0}catch(r){console.error("[AuthContext] Native auth login failed:",r);let t={user_id:e.googleUserId||"native_user",username:e.displayName||"Native User",role:"ADMIN",api_role:"ADMIN",permissions:["read","write","admin"],created_at:new Date().toISOString()};return u(t),d(!1),o&&(console.log("[AuthContext] Redirecting to setup wizard (mock user)"),localStorage.setItem("ciris_native_llm_mode","google"===a?"ciris_proxy":"custom"),f.push("/setup")),!0}}catch(e){return console.error("[AuthContext] Failed to parse native auth data:",e),!1}},_=async()=>{try{if(i.AQ.isAuthenticated()){let e=await i.AQ.auth.getMe();u(e)}}catch(e){console.error("Auth check failed:",e)}finally{d(!1)}},y=(0,r.useCallback)(async(e,t)=>{try{let a=localStorage.getItem("selectedAgentId");if(!a)throw Error("No agent selected");l._.configure(a);let o=await i.AQ.login(e,t),r=i.AQ.auth.getAccessToken();r&&l._.configure(a,r),u(o),s.Ay.success("Welcome, ".concat(o.username||o.user_id,"!")),f.push("/")}catch(e){throw s.Ay.error(e.message||"Login failed"),e}},[f]),A=(0,r.useCallback)(async()=>{try{await i.AQ.logout(),u(null),s.Ay.success("Logged out successfully"),f.push("/login")}catch(e){console.error("Logout failed:",e),s.Ay.error("Logout failed")}},[f]),C=(0,r.useCallback)(e=>!!a&&(a.permissions.includes(e)||"SYSTEM_ADMIN"===a.role),[a]),w=(0,r.useCallback)(e=>{if(!a)return!1;let t=["OBSERVER","ADMIN","AUTHORITY","SYSTEM_ADMIN"];return t.indexOf(a.role)>=t.indexOf(e)},[a]),v=(0,r.useCallback)(e=>{i.AQ.setConfig({authToken:e})},[]),S=(0,r.useCallback)(()=>!!h,[h]);return(0,o.jsx)(c.Provider,{value:{user:a,loading:g,login:y,logout:A,hasPermission:C,hasRole:w,setUser:u,setToken:v,managerToken:h,setManagerToken:m,isManagerAuthenticated:S},children:t})}function g(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9585:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(4568),r=a(7620),n=a(704),s=a(9484);function i(){let{user:e}=(0,s.A)(),[t,a]=(0,r.useState)([]),i=(e,t)=>{a(a=>[...a,{test:e,result:t,timestamp:new Date().toISOString()}])},l=async()=>{a([]),i("Auth Status",{isAuthenticated:n.AQ.isAuthenticated(),user:e,tokenInLocalStorage:!!localStorage.getItem("ciris_auth_token"),tokenInCookie:document.cookie.includes("auth_token")});try{let e=await n.AQ.memory.query("test",{limit:1});i("Memory Query",{success:!0,data:e})}catch(e){i("Memory Query",{success:!1,error:e.message})}try{let e=await n.AQ.config.getAll();i("Config Fetch",{success:!0,data:e})}catch(e){i("Config Fetch",{success:!1,error:e.message})}try{let e=await n.AQ.system.getHealth();i("System Health",{success:!0,data:e})}catch(e){i("System Health",{success:!1,error:e.message})}};return(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,o.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Auth Debug Page"}),(0,o.jsx)("button",{onClick:l,className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700",children:"Run Tests"})]})}),t.length>0&&(0,o.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,o.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,o.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Test Results"}),(0,o.jsx)("div",{className:"space-y-4",children:t.map((e,t)=>(0,o.jsxs)("div",{className:"border-t pt-4",children:[(0,o.jsx)("h3",{className:"font-medium text-gray-900",children:e.test}),(0,o.jsx)("pre",{className:"mt-2 text-xs bg-gray-50 p-2 rounded overflow-auto",children:JSON.stringify(e.result,null,2)})]},t))})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4534,704,587,8315,7358],()=>t(8366)),_N_E=e.O()}]);
