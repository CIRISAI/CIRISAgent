(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5009],{1569:(e,t,s)=>{Promise.resolve().then(s.bind(s,4811))},3120:(e,t,s)=>{"use strict";s.d(t,{_:()=>n});var a=s(704);function r(){let e=window.location.hostname,t=window.location.pathname,s=t.startsWith("/agent/");if("agents.ciris.ai"!==e&&!s)return{mode:"standalone",agentId:"default",apiBase:"/v1"};{let e="default";e=s?t.split("/")[2]||"default":localStorage.getItem("selectedAgentId")||"default";let a="/api/".concat(e,"/v1");return{mode:"managed",agentId:e,apiBase:a}}}var l=s(5950);class i{configure(e,t){let s,{mode:a}=r();if("managed"===a)s="".concat(window.location.origin,"/api/").concat(e);else{let t=localStorage.getItem("agent_".concat(e,"_api_url"));s=t||window.location.origin}t||(t=l.a.getAccessToken()||void 0);let i={baseURL:s,authToken:t,agentId:e,mode:a};return this.hasConfigChanged(i)&&this.applyConfiguration(i),i}configureForOAuthCallback(e,t){let s,{mode:a}=r(),l={baseURL:"managed"===a?"".concat(window.location.origin,"/api/").concat(e):window.location.origin,authToken:t,agentId:e,mode:a};return this.applyConfiguration(l),this.storeConfiguration(l),l}getCurrentConfig(){return this.currentConfig}isConfiguredFor(e){return!!this.currentConfig&&this.currentConfig.agentId===e&&!!this.currentConfig.authToken}clear(){this.currentConfig=null,localStorage.removeItem("sdk_config"),this.log("SDK configuration cleared")}applyConfiguration(e){this.log("Applying SDK configuration:",e),a.AQ.setConfig({baseURL:e.baseURL,authToken:e.authToken}),this.currentConfig=e,this.log("SDK configured successfully")}hasConfigChanged(e){return!this.currentConfig||this.currentConfig.baseURL!==e.baseURL||this.currentConfig.authToken!==e.authToken||this.currentConfig.agentId!==e.agentId||this.currentConfig.mode!==e.mode}storeConfiguration(e){let t={baseURL:e.baseURL,agentId:e.agentId,mode:e.mode};localStorage.setItem("sdk_config",JSON.stringify(t)),"standalone"===e.mode&&e.baseURL!==window.location.origin&&localStorage.setItem("agent_".concat(e.agentId,"_api_url"),e.baseURL)}restoreConfiguration(){let e=localStorage.getItem("sdk_config");if(!e)return null;try{let t=JSON.parse(e),s=l.a.getAccessToken()||void 0;return{...t,authToken:s}}catch(e){return null}}log(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];this.debugMode&&console.log("[SDKConfigManager]",...t)}constructor(){this.currentConfig=null,this.debugMode=!1}}let n=new i},4811:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var a=s(4568),r=s(7620),l=s(9484),i=s(6264),n=s(704),o=s(6626),d=s(6081),c=s(4893);function m(e){let{user:t,onClose:s,onPasswordChange:i,onMintWA:m,onUpdate:u}=e,{hasRole:x}=(0,l.A)(),[h,g]=(0,r.useState)(!1),[p,y]=(0,r.useState)(null),[f,v]=(0,r.useState)(!1),[j,b]=(0,r.useState)(t.api_role),w=async()=>{try{g(!0),y(null),await n.AQ.users.update(t.user_id,{api_role:j}),v(!1),u()}catch(e){y(e instanceof Error?e.message:"Failed to update role")}finally{g(!1)}},N=async()=>{if(confirm("Are you sure you want to deactivate this user?"))try{g(!0),y(null),await n.AQ.users.deactivate(t.user_id),u(),s()}catch(e){y(e instanceof Error?e.message:"Failed to deactivate user")}finally{g(!1)}};return(0,a.jsx)(o.e.Root,{show:!0,as:r.Fragment,children:(0,a.jsxs)(d.lG,{as:"div",className:"relative z-10",onClose:s,children:[(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,a.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center sm:p-0",children:(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,a.jsx)(d.lG.Panel,{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl",children:(0,a.jsxs)("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[(0,a.jsx)("div",{className:"absolute right-0 top-0 pr-4 pt-4",children:(0,a.jsxs)("button",{type:"button",className:"rounded-md bg-white text-gray-400 hover:text-gray-500",onClick:s,children:[(0,a.jsx)("span",{className:"sr-only",children:"Close"}),(0,a.jsx)(c.fK,{size:"lg",className:"text-gray-400"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 mb-4",children:"User Details"}),p&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:p})}),(0,a.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Basic Information"}),(0,a.jsxs)("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Username"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900",children:t.username})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"User ID"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 font-mono text-xs",children:t.user_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Auth Type"}),(0,a.jsxs)("dd",{className:"mt-1 text-sm text-gray-900",children:[t.auth_type,t.oauth_provider&&" (".concat(t.oauth_provider,")")]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900",children:t.oauth_email||"—"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Created"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900",children:new Date(t.created_at).toLocaleString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Last Login"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900",children:t.last_login?new Date(t.last_login).toLocaleString():"Never"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Roles & Permissions"}),(0,a.jsxs)("dl",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"API Role"}),(0,a.jsx)("dd",{className:"mt-1 flex items-center",children:f?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("select",{value:j,onChange:e=>b(e.target.value),className:"block rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[(0,a.jsx)("option",{value:"OBSERVER",children:"Observer"}),(0,a.jsx)("option",{value:"ADMIN",children:"Admin"}),(0,a.jsx)("option",{value:"AUTHORITY",children:"Authority"}),(0,a.jsx)("option",{value:"SYSTEM_ADMIN",children:"System Admin"})]}),(0,a.jsx)("button",{onClick:w,disabled:h,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",children:"Save"}),(0,a.jsx)("button",{onClick:()=>{v(!1),b(t.api_role)},className:"inline-flex items-center px-3 py-1 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:t.api_role}),x("SYSTEM_ADMIN")&&(0,a.jsx)("button",{onClick:()=>v(!0),className:"text-sm text-indigo-600 hover:text-indigo-900",children:"Edit"})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"WA Status"}),(0,a.jsxs)("dd",{className:"mt-1 flex items-center justify-between",children:[t.wa_role?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.Zu,{size:"md",className:"text-purple-600"}),(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800 ring-2 ring-purple-600",children:t.wa_role.toUpperCase()}),t.wa_parent_id&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Minted by: ",t.wa_parent_id]})]}):(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Not a Wise Authority"}),(x("SYSTEM_ADMIN")||x("AUTHORITY")||x("ADMIN"))&&!t.wa_role&&(0,a.jsxs)("button",{onClick:m,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-purple-700 bg-purple-100 hover:bg-purple-200",children:[(0,a.jsx)(c.Zu,{size:"sm",className:"mr-1"}),"Mint as WA"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"API Keys"}),(0,a.jsxs)("dd",{className:"mt-1 text-sm text-gray-900",children:[t.api_keys_count," active keys"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Permissions"}),(0,a.jsx)("dd",{className:"mt-1",children:(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto",children:(0,a.jsx)("ul",{className:"text-xs space-y-1",children:t.permissions.map(e=>(0,a.jsxs)("li",{className:"text-gray-600",children:["• ",e]},e))})})})]})]})]}),(0,a.jsx)("div",{className:"border-t pt-6",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:["password"===t.auth_type&&(0,a.jsxs)("button",{onClick:i,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[(0,a.jsx)(c.RY,{size:"sm",className:"mr-2"}),"Change Password"]}),x("SYSTEM_ADMIN")&&t.is_active&&(0,a.jsxs)("button",{onClick:N,disabled:h,className:"inline-flex items-center px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 disabled:opacity-50",children:[(0,a.jsx)(c.uc,{size:"sm",className:"mr-2"}),"Deactivate User"]})]})})]})]})]})})})})})]})})}var u=s(3851),x=s(297);function h(e){let{userId:t,username:s,onClose:i,onSuccess:c}=e,{user:m}=(0,l.A)(),[h,g]=(0,r.useState)(""),[p,y]=(0,r.useState)(""),[f,v]=(0,r.useState)(""),[j,b]=(0,r.useState)(!1),[w,N]=(0,r.useState)(null),C=(null==m?void 0:m.user_id)===t,k=async e=>{if(e.preventDefault(),p!==f)return void N("New passwords do not match");if(p.length<8)return void N("Password must be at least 8 characters long");try{b(!0),N(null),await n.AQ.users.changePassword(t,{current_password:h,new_password:p}),c(),i()}catch(e){N(e instanceof Error?e.message:"Failed to change password")}finally{b(!1)}};return(0,a.jsx)(o.e.Root,{show:!0,as:r.Fragment,children:(0,a.jsxs)(d.lG,{as:"div",className:"relative z-10",onClose:i,children:[(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,a.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,a.jsxs)(d.lG.Panel,{className:"relative transform overflow-hidden rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-md sm:p-6",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 pt-4 pr-4",children:(0,a.jsxs)("button",{type:"button",className:"rounded-md bg-white text-gray-400 hover:text-gray-500",onClick:i,children:[(0,a.jsx)("span",{className:"sr-only",children:"Close"}),(0,a.jsx)(u.A,{className:"h-6 w-6"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-indigo-100",children:(0,a.jsx)(x.A,{className:"h-6 w-6 text-indigo-600"})}),(0,a.jsxs)("div",{className:"mt-3 text-center sm:mt-5",children:[(0,a.jsx)(d.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:"Change Password"}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:C?"Enter your current password and choose a new one":"Change password for ".concat(s)})})]})]}),w&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:w})}),(0,a.jsxs)("form",{onSubmit:k,className:"mt-6 space-y-4",children:[C&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"current-password",className:"block text-sm font-medium text-gray-700",children:"Current Password"}),(0,a.jsx)("input",{type:"password",id:"current-password",value:h,onChange:e=>g(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"new-password",className:"block text-sm font-medium text-gray-700",children:"New Password"}),(0,a.jsx)("input",{type:"password",id:"new-password",value:p,onChange:e=>y(e.target.value),required:!0,minLength:8,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Must be at least 8 characters long"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-700",children:"Confirm New Password"}),(0,a.jsx)("input",{type:"password",id:"confirm-password",value:f,onChange:e=>v(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),!C&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:(0,a.jsxs)("p",{className:"text-xs text-yellow-800",children:[(0,a.jsx)("strong",{children:"Note:"})," As a system administrator, you can change this user's password without knowing their current password."]})}),(0,a.jsxs)("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:j,className:"inline-flex w-full justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:col-start-2 sm:text-sm disabled:opacity-50",children:j?"Saving...":"Change Password"}),(0,a.jsx)("button",{type:"button",onClick:i,className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:col-start-1 sm:mt-0 sm:text-sm",children:"Cancel"})]})]})]})})})})]})})}function g(e){let{user:t,onClose:s,onSuccess:l,isSelfMint:i=!1}=e,[m,u]=(0,r.useState)("observer"),[x,h]=(0,r.useState)(""),[g,p]=(0,r.useState)("~/.ciris/wa_keys/root_wa.key"),[y,f]=(0,r.useState)(!1),[v,j]=(0,r.useState)(null),[b,w]=(0,r.useState)(!1),[N,C]=(0,r.useState)(null),[k,A]=(0,r.useState)(!1),[S,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=setTimeout(async()=>{if(g){A(!0);try{let e=await n.AQ.users.checkWAKeyExists(g);C(!!e.exists&&!!e.valid_size),e.exists&&e.valid_size&&_(!0)}catch(e){console.error("Failed to check key:",e),C(!1)}finally{A(!1)}}},500);return()=>clearTimeout(e)},[g]);let M=async e=>{e.preventDefault();try{f(!0),j(null);let e={wa_role:m};if(S&&N)e.private_key_path=g;else{if(!x)throw Error("Please provide a signature or enable auto-signing");e.signature=x}await n.AQ.users.mintWiseAuthority(t.user_id,e),l(),s()}catch(e){j(e instanceof Error?e.message:"Failed to mint as Wise Authority")}finally{f(!1)}};return(0,a.jsx)(o.e.Root,{show:!0,as:r.Fragment,children:(0,a.jsxs)(d.lG,{as:"div",className:"relative z-10",onClose:s,children:[(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,a.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center p-4 text-center",children:(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,a.jsxs)(d.lG.Panel,{className:"relative w-full max-w-lg max-h-[calc(100vh-2rem)] mx-auto bg-white rounded-lg shadow-xl flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 pt-5 pb-4 sm:p-6 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-purple-100",children:(0,a.jsx)(c.lm,{size:"md",className:"text-purple-600"})}),(0,a.jsx)(d.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:i?"Bootstrap Wise Authority":"Mint as Wise Authority"})]}),(0,a.jsxs)("button",{type:"button",className:"rounded-md bg-white text-gray-400 hover:text-gray-500",onClick:s,children:[(0,a.jsx)("span",{className:"sr-only",children:"Close"}),(0,a.jsx)(c.fK,{size:"lg",className:"text-gray-400"})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 pt-5 pb-4 sm:p-6",children:[(0,a.jsx)("div",{className:"text-center mb-6",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:i?(0,a.jsxs)(a.Fragment,{children:["You are about to mint yourself (",(0,a.jsx)("span",{className:"font-medium",children:t.username}),") as the first Wise Authority.",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs text-amber-600 mt-2 block",children:"This requires the root WA private key to sign the transaction."})]}):(0,a.jsxs)(a.Fragment,{children:["Grant Wise Authority status to ",(0,a.jsx)("span",{className:"font-medium",children:t.username})]})})}),v&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:v})}),(0,a.jsxs)("form",{onSubmit:M,className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"wa-role",className:"block text-sm font-medium text-gray-700",children:"WA Role"}),(0,a.jsxs)("select",{id:"wa-role",value:m,onChange:e=>u(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[(0,a.jsx)("option",{value:"observer",children:"Observer"}),(0,a.jsx)("option",{value:"authority",children:"Authority"})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"authority"===m?"Can approve deferrals and provide guidance":"Can observe and monitor the system"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"private-key-path",className:"block text-sm font-medium text-gray-700",children:"Private Key Path"}),(0,a.jsx)("input",{type:"text",id:"private-key-path",value:g,onChange:e=>p(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Path to your ROOT private key file"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Path to your ROOT private key file (e.g., ~/.ciris/wa_keys/root_wa.key)"}),k&&(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-400",children:"Checking key..."}),!k&&null!==N&&(0,a.jsx)("p",{className:"mt-1 text-xs ".concat(N?"text-green-600":"text-red-600"),children:N?"✓ Key found - auto-signing available":"✗ Key not found at this path"})]}),N&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"use-auto-sign",checked:S,onChange:e=>_(e.target.checked),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,a.jsx)("label",{htmlFor:"use-auto-sign",className:"ml-2 block text-sm text-gray-700",children:"Use auto-signing (sign on server with private key)"})]}),(!S||!N)&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("label",{htmlFor:"root-key",className:"block text-sm font-medium text-gray-700",children:"ROOT Signature"}),(0,a.jsx)("button",{type:"button",onClick:()=>w(!b),className:"text-xs text-indigo-600 hover:text-indigo-500",children:"How to sign?"})]}),(0,a.jsx)("textarea",{id:"root-key",value:x,onChange:e=>h(e.target.value),required:!S||!N,rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono text-xs",placeholder:"Paste ONLY the signature value (e.g., EjRdHhbaEySL...) - NOT the 'Signature:' prefix"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:'Paste the base64 signature from the command output (without "Signature:" prefix)'})]}),b&&(0,a.jsxs)("div",{className:"bg-gray-50 rounded-md p-4 text-xs space-y-3",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900",children:"How to Generate Your Signature:"}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:[(0,a.jsx)("p",{className:"font-semibold text-blue-900 mb-2",children:"Step 1: Run this command in your terminal:"}),(0,a.jsxs)("code",{className:"block bg-white p-2 rounded text-xs font-mono break-all border border-blue-300",children:["python /home/emoore/CIRISAgent/scripts/security/sign_wa_mint.py ",t.user_id," ",m," ",g||"~/.ciris/wa_keys/root_wa.key"]})]}),(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded p-3",children:[(0,a.jsx)("p",{className:"font-semibold text-green-900 mb-1",children:"Step 2: Copy ONLY the signature line:"}),(0,a.jsxs)("div",{className:"bg-white p-2 rounded border border-green-300",children:[(0,a.jsx)("p",{className:"text-gray-600 text-xs",children:"The output will show:"}),(0,a.jsxs)("p",{className:"font-mono text-xs text-gray-500",children:["Message: MINT_WA:",t.user_id,":",m]}),(0,a.jsxs)("p",{className:"font-mono text-xs text-green-700 font-bold",children:["Signature: ",(0,a.jsx)("span",{className:"bg-yellow-100 px-1",children:"EjRdHhbaEySL...us9AAw=="})]}),(0,a.jsx)("p",{className:"text-green-800 mt-2 font-semibold",children:'↑ Copy this value (without "Signature:")'})]})]}),(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded p-3",children:[(0,a.jsx)("p",{className:"font-semibold text-amber-900 mb-1",children:"Step 3: Paste the signature:"}),(0,a.jsx)("p",{className:"text-amber-800",children:'Paste ONLY the base64 string (like "EjRdHhbaEySL...") into the signature field above'})]}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:(0,a.jsxs)("p",{className:"text-red-800 text-xs",children:[(0,a.jsx)("strong",{children:"⚠️ Security:"})," Never share your private key. Only paste the signature."]})})]}),(0,a.jsxs)("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:y,className:"inline-flex w-full justify-center rounded-md border border-transparent bg-purple-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 sm:col-start-2 sm:text-sm disabled:opacity-50",children:y?"Minting...":"Mint Authority"}),(0,a.jsx)("button",{type:"button",onClick:s,className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:col-start-1 sm:mt-0 sm:text-sm",children:"Cancel"})]})]})]})]})})})})]})})}function p(e){let{onClose:t}=e,[s,l]=(0,r.useState)([]),[i,m]=(0,r.useState)(!0),[u,x]=(0,r.useState)(null),[h,g]=(0,r.useState)(!1),[p,y]=(0,r.useState)(""),[f,v]=(0,r.useState)(""),[j,b]=(0,r.useState)(""),[w,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{C()},[]);let C=async()=>{try{m(!0);let e=await n.AQ.auth.listOAuthProviders();l(e.providers)}catch(e){x(e instanceof Error?e.message:"Failed to load OAuth providers")}finally{m(!1)}},k=async e=>{e.preventDefault();try{N(!0),x(null),await n.AQ.auth.configureOAuthProvider(p,f,j),y(""),v(""),b(""),g(!1),await C()}catch(e){x(e instanceof Error?e.message:"Failed to configure provider")}finally{N(!1)}},A=e=>{switch(e.toLowerCase()){case"google":return"\uD83D\uDD35";case"github":return"\uD83D\uDC19";case"discord":return"\uD83D\uDCAC";default:return"\uD83D\uDD11"}};return(0,a.jsx)(o.e.Root,{show:!0,as:r.Fragment,children:(0,a.jsxs)(d.lG,{as:"div",className:"relative z-10",onClose:t,children:[(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,a.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center p-4 text-center",children:(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,a.jsxs)(d.lG.Panel,{className:"relative w-full max-w-2xl max-h-[calc(100vh-2rem)] mx-auto bg-white rounded-lg shadow-xl flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 pt-5 pb-4 sm:p-6 border-b",children:[(0,a.jsx)(d.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:"OAuth Provider Configuration"}),(0,a.jsxs)("button",{type:"button",className:"rounded-md bg-white text-gray-400 hover:text-gray-500",onClick:t,children:[(0,a.jsx)("span",{className:"sr-only",children:"Close"}),(0,a.jsx)(c.fK,{size:"lg",className:"text-gray-400"})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 pt-5 pb-4 sm:p-6",children:[u&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:u})}),(0,a.jsx)("div",{className:"mt-6",children:i?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsxs)("div",{className:"inline-flex items-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-indigo-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading providers..."]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-3",children:[s.map(e=>(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-2xl mr-3",children:A(e.provider)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 capitalize",children:e.provider}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Client ID: ",e.client_id]})]})]}),(0,a.jsxs)("div",{className:"mt-3 text-xs",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"Callback URL:"}),(0,a.jsx)("code",{className:"block mt-1 p-2 bg-gray-100 rounded text-gray-800",children:"".concat(window.location.origin,"/oauth/{agent}/callback")}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Replace ","{agent}"," with: datum, sage, scout, echo-core, or echo-speculative"]})]})]})})},e.provider)),0===s.length&&!h&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"No OAuth providers configured yet"}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 max-w-lg mx-auto",children:[(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"Callback URL format:"}),(0,a.jsxs)("code",{className:"block text-xs p-2 bg-gray-100 rounded text-gray-800",children:[window.location.origin,"/oauth/","{agent}","/callback"]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Replace ","{agent}"," with: datum, sage, scout, echo-core, or echo-speculative"]})]})]})]}),h?(0,a.jsxs)("form",{onSubmit:k,className:"mt-6 bg-blue-50 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Add OAuth Provider"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"provider",className:"block text-sm font-medium text-gray-700",children:"Provider"}),(0,a.jsxs)("select",{id:"provider",value:p,onChange:e=>y(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[(0,a.jsx)("option",{value:"",children:"Select a provider"}),(0,a.jsx)("option",{value:"google",children:"Google"}),(0,a.jsx)("option",{value:"github",children:"GitHub"}),(0,a.jsx)("option",{value:"discord",children:"Discord"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"client-id",className:"block text-sm font-medium text-gray-700",children:"Client ID"}),(0,a.jsx)("input",{type:"text",id:"client-id",value:f,onChange:e=>v(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Your OAuth app client ID"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"client-secret",className:"block text-sm font-medium text-gray-700",children:"Client Secret"}),(0,a.jsx)("input",{type:"password",id:"client-secret",value:j,onChange:e=>b(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Your OAuth app client secret"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{g(!1),y(""),v(""),b("")},className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:w,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",children:w?"Saving...":"Add Provider"})]})]})]}):(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsxs)("button",{onClick:()=>g(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700",children:[(0,a.jsx)(c.c1,{size:"sm",className:"mr-2"}),"Add Provider"]})}),(0,a.jsxs)("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-md p-4",children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Setup Instructions"}),(0,a.jsxs)("ol",{className:"text-xs text-yellow-700 space-y-1 list-decimal list-inside",children:[(0,a.jsx)("li",{children:"Create an OAuth app in your provider's developer console"}),(0,a.jsx)("li",{children:"Set the redirect URI to the callback URL shown above"}),(0,a.jsx)("li",{children:"Copy the client ID and secret from your OAuth app"}),(0,a.jsx)("li",{children:"Configure the provider here with those credentials"}),(0,a.jsx)("li",{children:"OAuth login buttons will appear on the login page"})]})]})]})})]})]})})})})]})})}function y(e){let{onClose:t,onSuccess:s}=e,[l,i]=(0,r.useState)(""),[m,u]=(0,r.useState)(""),[x,h]=(0,r.useState)(""),[g,p]=(0,r.useState)("OBSERVER"),[y,f]=(0,r.useState)(!1),[v,j]=(0,r.useState)(null),b=async e=>{if(e.preventDefault(),m!==x)return void j("Passwords do not match");if(m.length<8)return void j("Password must be at least 8 characters long");try{f(!0),j(null),await n.AQ.users.create({username:l,password:m,api_role:g}),s(),t()}catch(e){j(e instanceof Error?e.message:"Failed to create user")}finally{f(!1)}};return(0,a.jsx)(o.e.Root,{show:!0,as:r.Fragment,children:(0,a.jsxs)(d.lG,{as:"div",className:"relative z-10",onClose:t,children:[(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,a.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center p-4 text-center",children:(0,a.jsx)(o.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,a.jsxs)(d.lG.Panel,{className:"relative w-full max-w-lg max-h-[calc(100vh-2rem)] mx-auto bg-white rounded-lg shadow-xl flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 pt-5 pb-4 sm:p-6 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-indigo-100",children:(0,a.jsx)(c.Rv,{size:"md",className:"text-indigo-600"})}),(0,a.jsx)(d.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:"Add New User"})]}),(0,a.jsxs)("button",{type:"button",className:"rounded-md bg-white text-gray-400 hover:text-gray-500",onClick:t,children:[(0,a.jsx)("span",{className:"sr-only",children:"Close"}),(0,a.jsx)(c.fK,{size:"lg",className:"text-gray-400"})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 pt-5 pb-4 sm:p-6",children:[(0,a.jsx)("div",{className:"text-center mb-6",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Create a new user account with password authentication"})}),v&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:v})}),(0,a.jsxs)("form",{onSubmit:b,className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Username"}),(0,a.jsx)("input",{type:"text",id:"username",value:l,onChange:e=>i(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Enter username"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),(0,a.jsx)("input",{type:"password",id:"password",value:m,onChange:e=>u(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Enter password"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Must be at least 8 characters long"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),(0,a.jsx)("input",{type:"password",id:"confirm-password",value:x,onChange:e=>h(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Confirm password"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"api-role",className:"block text-sm font-medium text-gray-700",children:"API Role"}),(0,a.jsxs)("select",{id:"api-role",value:g,onChange:e=>p(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[(0,a.jsx)("option",{value:"OBSERVER",children:"Observer"}),(0,a.jsx)("option",{value:"ADMIN",children:"Admin"}),(0,a.jsx)("option",{value:"AUTHORITY",children:"Authority"}),(0,a.jsx)("option",{value:"SYSTEM_ADMIN",children:"System Admin"})]}),(0,a.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["OBSERVER"===g&&"Can view data but not make changes","ADMIN"===g&&"Can manage users and configuration","AUTHORITY"===g&&"Can view WA deferrals and guidance","SYSTEM_ADMIN"===g&&"Full system access and control"]})]}),(0,a.jsxs)("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:y,className:"inline-flex w-full justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:col-start-2 sm:text-sm disabled:opacity-50",children:y?"Creating...":"Create User"}),(0,a.jsx)("button",{type:"button",onClick:t,className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:col-start-1 sm:mt-0 sm:text-sm",children:"Cancel"})]})]})]})]})})})})]})})}function f(){let{hasRole:e,user:t}=(0,l.A)(),[s,o]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[x,f]=(0,r.useState)(null),[v,j]=(0,r.useState)(null),[b,w]=(0,r.useState)(null),[N,C]=(0,r.useState)(null),[k,A]=(0,r.useState)(!1),[S,_]=(0,r.useState)(!1),[M,R]=(0,r.useState)(!1),[z,I]=(0,r.useState)(null),[T,F]=(0,r.useState)(1),[E,L]=(0,r.useState)(1),[O,P]=(0,r.useState)(""),[D,U]=(0,r.useState)(""),[B,H]=(0,r.useState)("");(0,r.useEffect)(()=>{W()},[T,O,D,B]),(0,r.useEffect)(()=>{(async()=>{if(null==t?void 0:t.user_id)try{let e=await n.AQ.users.get(t.user_id);I(e)}catch(e){console.error("Failed to load current user details:",e)}})()},[t]);let W=async()=>{try{u(!0);let e=await n.AQ.users.list({page:T,page_size:20,search:O||void 0,api_role:D||void 0,auth_type:B||void 0});o(e.items),L(e.pages)}catch(e){f(e instanceof Error?e.message:"Failed to load users")}finally{u(!1)}},Y=s.some(e=>null!==e.wa_role&&void 0!==e.wa_role),V=async e=>{try{let t=await n.AQ.users.get(e);j(t)}catch(e){f(e instanceof Error?e.message:"Failed to load user details")}},Q=e=>{switch(e){case"SYSTEM_ADMIN":return"bg-red-100 text-red-800";case"AUTHORITY":return"bg-purple-100 text-purple-800";case"ADMIN":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},G=e=>{switch(e){case"authority":return"bg-purple-100 text-purple-800 ring-2 ring-purple-600";case"admin":return"bg-blue-100 text-blue-800 ring-2 ring-blue-600";case"root":return"bg-red-100 text-red-800 ring-2 ring-red-600";default:return"bg-green-100 text-green-800"}};return(0,a.jsxs)(i.O,{requiredRole:"ADMIN",children:[(0,a.jsxs)("div",{className:"px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"sm:flex sm:items-center",children:[(0,a.jsxs)("div",{className:"sm:flex-auto",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"User Management"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-700",children:"Manage users, roles, and Wise Authority assignments"})]}),(0,a.jsxs)("div",{className:"mt-4 sm:mt-0 sm:ml-16 sm:flex-none space-x-2",children:[z&&!z.wa_role&&(!Y||e("SYSTEM_ADMIN")||e("ADMIN"))&&(0,a.jsxs)("button",{onClick:()=>{C(z),R(!0)},className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100",title:Y?"Mint yourself as Wise Authority":"Bootstrap first Wise Authority",children:[(0,a.jsx)(c.Zu,{size:"md",className:"-ml-1 mr-2 text-purple-600"}),Y?"Self-Mint as WA":"Bootstrap First WA"]}),e("SYSTEM_ADMIN")&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>A(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[(0,a.jsx)(c.RY,{size:"md",className:"-ml-1 mr-2 text-gray-500"}),"OAuth Config"]}),(0,a.jsxs)("button",{onClick:()=>_(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700",children:[(0,a.jsx)(c.Rv,{size:"md",className:"-ml-1 mr-2"}),"Add User"]})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 grid grid-cols-1 gap-4 sm:grid-cols-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700",children:"Search"}),(0,a.jsx)("input",{type:"text",id:"search",value:O,onChange:e=>P(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Search by name..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:"API Role"}),(0,a.jsxs)("select",{id:"role",value:D,onChange:e=>U(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[(0,a.jsx)("option",{value:"",children:"All Roles"}),(0,a.jsx)("option",{value:"OBSERVER",children:"Observer"}),(0,a.jsx)("option",{value:"ADMIN",children:"Admin"}),(0,a.jsx)("option",{value:"AUTHORITY",children:"Authority"}),(0,a.jsx)("option",{value:"SYSTEM_ADMIN",children:"System Admin"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"auth-type",className:"block text-sm font-medium text-gray-700",children:"Auth Type"}),(0,a.jsxs)("select",{id:"auth-type",value:B,onChange:e=>H(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[(0,a.jsx)("option",{value:"",children:"All Types"}),(0,a.jsx)("option",{value:"password",children:"Password"}),(0,a.jsx)("option",{value:"oauth",children:"OAuth"}),(0,a.jsx)("option",{value:"api_key",children:"API Key"})]})]})]}),(0,a.jsx)("div",{className:"mt-8 flex flex-col",children:(0,a.jsx)("div",{className:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,a.jsx)("div",{className:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:d?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsxs)("div",{className:"inline-flex items-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-indigo-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading users..."]})}):x?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-red-600",children:x})}):(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-300",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Auth Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"API Role"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"WA Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Login"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"relative px-6 py-3",children:(0,a.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.username}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.oauth_email||e.user_id})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.auth_type}),e.oauth_provider&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",e.oauth_provider,")"]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(Q(e.api_role)),children:e.api_role})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.wa_role?(0,a.jsxs)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(G(e.wa_role)),children:[(0,a.jsx)(c.Zu,{size:"xs",className:"mr-1"}),e.wa_role.toUpperCase()]}):(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"—"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.last_login?new Date(e.last_login).toLocaleDateString():"Never"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.is_active?(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full",children:"Active"}):(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold text-red-800 bg-red-100 rounded-full",children:"Inactive"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>V(e.user_id),className:"text-indigo-600 hover:text-indigo-900",children:(0,a.jsx)(c.vK,{size:"md"})})})]},e.user_id))})]})})})})}),E>1&&(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,a.jsx)("button",{onClick:()=>F(Math.max(1,T-1)),disabled:1===T,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>F(Math.min(E,T+1)),disabled:T===E,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Next"})]}),(0,a.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:["Page ",(0,a.jsx)("span",{className:"font-medium",children:T})," of"," ",(0,a.jsx)("span",{className:"font-medium",children:E})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[(0,a.jsx)("button",{onClick:()=>F(Math.max(1,T-1)),disabled:1===T,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>F(Math.min(E,T+1)),disabled:T===E,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})})]})]})]}),v&&(0,a.jsx)(m,{user:v,onClose:()=>j(null),onPasswordChange:()=>{w(v),j(null)},onMintWA:()=>{C(v),j(null)},onUpdate:()=>{W(),V(v.user_id)}}),b&&(0,a.jsx)(h,{userId:b.user_id,username:b.username,onClose:()=>w(null),onSuccess:()=>{w(null),W()}}),N&&(0,a.jsx)(g,{user:N,onClose:()=>{C(null),R(!1)},onSuccess:()=>{C(null),R(!1),W(),M&&(null==t?void 0:t.user_id)&&n.AQ.users.get(t.user_id).then(I)},isSelfMint:M}),k&&(0,a.jsx)(p,{onClose:()=>A(!1)}),S&&(0,a.jsx)(y,{onClose:()=>_(!1),onSuccess:()=>{_(!1),W()}})]})}},4893:(e,t,s)=>{"use strict";s.d(t,{DP:()=>y,HG:()=>m,Nl:()=>o,O4:()=>c,Pi:()=>i,RR:()=>h,RY:()=>x,Rv:()=>f,XR:()=>n,Zu:()=>j,bN:()=>g,c1:()=>w,fC:()=>N,fK:()=>v,lm:()=>p,md:()=>A,mo:()=>l,uc:()=>b,ui:()=>d,vK:()=>u,xZ:()=>C,xm:()=>k});var a=s(4568);s(7620);let r={xs:{width:12,height:12},sm:{width:16,height:16},md:{width:20,height:20},lg:{width:24,height:24}},l=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})},i=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})},n=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{d:"M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V9.236a1 1 0 00-1.447-.894l-4 2a1 1 0 00-.553.894V17zM15.211 6.276a1 1 0 000-1.788l-4.764-2.382a1 1 0 00-.894 0L4.789 4.488a1 1 0 000 1.788l4.764 2.382a1 1 0 00.894 0l4.764-2.382zM4.447 8.342A1 1 0 003 9.236V15a1 1 0 00.553.894l4 2A1 1 0 009 17v-5.764a1 1 0 00-.553-.894l-4-2z"})})},o=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsxs)("svg",{className:"animate-spin ".concat(t),width:l,height:i,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},d=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})},c=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})},m=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})})},u=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})},x=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z",clipRule:"evenodd"})})},h=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M2 5a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm14 1a1 1 0 11-2 0 1 1 0 012 0zM2 13a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2v-2zm14 1a1 1 0 11-2 0 1 1 0 012 0z",clipRule:"evenodd"})})},g=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsxs)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:[(0,a.jsx)("path",{d:"M3 12v3c0 1.657 3.134 3 7 3s7-1.343 7-3v-3c0 1.657-3.134 3-7 3s-7-1.343-7-3z"}),(0,a.jsx)("path",{d:"M3 7v3c0 1.657 3.134 3 7 3s7-1.343 7-3V7c0 1.657-3.134 3-7 3S3 8.657 3 7z"}),(0,a.jsx)("path",{d:"M17 5c0 1.657-3.134 3-7 3S3 6.657 3 5s3.134-3 7-3 7 1.343 7 3z"})]})},p=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})},y=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})})},f=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"})})},v=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})},j=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})},b=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})},w=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})})},N=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},C=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})},k=e=>{let{className:t="",size:s="md"}=e,{width:l,height:i}=r[s];return(0,a.jsx)("svg",{className:t,width:l,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},A=e=>{let{status:t,className:s=""}=e;return(0,a.jsx)("span",{className:"w-3 h-3 rounded-full ".concat({green:"bg-green-500",yellow:"bg-yellow-500",red:"bg-red-500",gray:"bg-gray-500"}[t]," ").concat(s)})}},6264:(e,t,s)=>{"use strict";s.d(t,{O:()=>n});var a=s(4568),r=s(7620),l=s(2942),i=s(9484);function n(e){let{children:t,requiredRole:s,requiredPermission:n}=e,{user:o,loading:d,hasRole:c,hasPermission:m}=(0,i.A)(),u=(0,l.useRouter)();return((0,r.useEffect)(()=>{if(!d){if(!o)return void u.push("/login");if(s&&!c(s)||n&&!m(n))return void u.push("/unauthorized")}},[o,d,s,n,c,m,u]),d)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"text-lg",children:"Loading..."})}):o&&(!s||c(s))&&(!n||m(n))?(0,a.jsx)(a.Fragment,{children:t}):null}},9484:(e,t,s)=>{"use strict";s.d(t,{A:()=>m,O:()=>c});var a=s(4568),r=s(7620),l=s(2942),i=s(3237),n=s(704),o=s(3120);let d=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0),[x,h]=(0,r.useState)(null),g=(0,l.useRouter)();(0,r.useEffect)(()=>{let e=window.location.pathname;"/login"===e||e.startsWith("/manager")?u(!1):p().then(e=>{e||y()});let t=localStorage.getItem("manager_token");t&&h(t);let s=e=>{console.log("[AuthContext] Native auth ready event received"),p()};return window.addEventListener("ciris_native_auth_ready",s),()=>{window.removeEventListener("ciris_native_auth_ready",s)}},[]);let p=async()=>{let e="true"===localStorage.getItem("isNativeApp"),t=localStorage.getItem("ciris_native_auth"),s=localStorage.getItem("ciris_auth_method"),a="true"===localStorage.getItem("ciris_show_setup");if(!e||!t)return!1;try{let e=JSON.parse(t);console.log("[AuthContext] Native auth detected - method:",s,"showSetup:",a),localStorage.setItem("selectedAgentId","datum"),o._.configure("datum");try{let e=await n.AQ.login("admin","ciris_admin_password"),t=n.AQ.auth.getAccessToken();return t&&o._.configure("datum",t),c(e),console.log("[AuthContext] Native auth login successful"),u(!1),a&&(console.log("[AuthContext] Redirecting to setup wizard"),localStorage.setItem("ciris_native_llm_mode","google"===s?"ciris_proxy":"custom"),g.push("/setup")),!0}catch(r){console.error("[AuthContext] Native auth login failed:",r);let t={user_id:e.googleUserId||"native_user",username:e.displayName||"Native User",role:"ADMIN",api_role:"ADMIN",permissions:["read","write","admin"],created_at:new Date().toISOString()};return c(t),u(!1),a&&(console.log("[AuthContext] Redirecting to setup wizard (mock user)"),localStorage.setItem("ciris_native_llm_mode","google"===s?"ciris_proxy":"custom"),g.push("/setup")),!0}}catch(e){return console.error("[AuthContext] Failed to parse native auth data:",e),!1}},y=async()=>{try{if(n.AQ.isAuthenticated()){let e=await n.AQ.auth.getMe();c(e)}}catch(e){console.error("Auth check failed:",e)}finally{u(!1)}},f=(0,r.useCallback)(async(e,t)=>{try{let s=localStorage.getItem("selectedAgentId");if(!s)throw Error("No agent selected");o._.configure(s);let a=await n.AQ.login(e,t),r=n.AQ.auth.getAccessToken();r&&o._.configure(s,r),c(a),i.Ay.success("Welcome, ".concat(a.username||a.user_id,"!")),g.push("/")}catch(e){throw i.Ay.error(e.message||"Login failed"),e}},[g]),v=(0,r.useCallback)(async()=>{try{await n.AQ.logout(),c(null),i.Ay.success("Logged out successfully"),g.push("/login")}catch(e){console.error("Logout failed:",e),i.Ay.error("Logout failed")}},[g]),j=(0,r.useCallback)(e=>!!s&&(s.permissions.includes(e)||"SYSTEM_ADMIN"===s.role),[s]),b=(0,r.useCallback)(e=>{if(!s)return!1;let t=["OBSERVER","ADMIN","AUTHORITY","SYSTEM_ADMIN"];return t.indexOf(s.role)>=t.indexOf(e)},[s]),w=(0,r.useCallback)(e=>{n.AQ.setConfig({authToken:e})},[]),N=(0,r.useCallback)(()=>!!x,[x]);return(0,a.jsx)(d.Provider,{value:{user:s,loading:m,login:f,logout:v,hasPermission:j,hasRole:b,setUser:c,setToken:w,managerToken:x,setManagerToken:h,isManagerAuthenticated:N},children:t})}function m(){let e=(0,r.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[4534,8386,704,587,8315,7358],()=>t(1569)),_N_E=e.O()}]);
